package mandlebrot.graph;

import java.awt.Canvas;
import java.awt.Color;
import java.awt.Dimension;
import java.awt.Font;
import java.awt.Graphics;
import java.awt.image.BufferStrategy;

import javax.swing.JFrame;

public class ProgressInfo extends Canvas{
	
	private static final int WIDTH = 200;
	private static final int HEIGHT = 100;
	
	private static final long serialVersionUID = -6880647534477952882L;
	
	
	private JFrame jFrame;
	private Grapher grapher;
	
	public ProgressInfo(Grapher grapher) {
		this.jFrame = new JFrame();
		this.grapher = grapher;
		
		jFrame.add(this);
		jFrame.setTitle("Progress");
		jFrame.setLocationRelativeTo(null);
		jFrame.setLocation(0, 0);
		this.setPreferredSize(new Dimension(WIDTH, HEIGHT));
		jFrame.setResizable(false);
		jFrame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
		jFrame.setVisible(true);
		jFrame.pack();
		this.setBackground(Color.white);
	}
	
	public void startTimer(int total) {
		long firstTime = System.nanoTime();
		long lastTime = System.nanoTime();
		long currentTime = System.nanoTime();
		int lastCompleated = 0;
		long sleepTime = 10l;
		try {
			Thread.sleep(sleepTime);
		} catch (InterruptedException e) {
			e.printStackTrace();
		}
		while (grapher.getPixelsCompleated() < total) {
			currentTime = System.nanoTime();
			double elapsed = (currentTime - firstTime) / 1.0E9;
			double percentProcessed = grapher.getPixelsCompleated() / (double) total * 100.0;


			lastTime = System.nanoTime();
			lastCompleated = grapher.getPixelsCompleated();
			
			String out = "";
			out += "\n" + (grapher.getPixelsCompleated() / (double) total * 100.0) + "%";
			out += "\nTotal time elapsed: " + toTime(elapsed);
			//System.out.println(out);
			render(percentProcessed, elapsed);
			
//			try {
//				Thread.sleep(sleepTime);
//			} catch (InterruptedException e) {
//				e.printStackTrace();
//			}
		}
	}


	private static String toTime(double t) {
		if (t > 60.0) {
			t /= 60.0;
			if (t > 60.0) {
				t /= 60.0;
				return t + "h";
			} else {
				return t + "m";
			}
		} else {
			return t + "s";
		}
	}
	
	private void render(double percent, double timeElapsed) {
		BufferStrategy bs = this.getBufferStrategy();
		if (bs == null) {
			createBufferStrategy(3);
			return;
		}
		Graphics g = bs.getDrawGraphics();
		
		g.setColor(Color.blue);
		g.setFont(new Font("bold", 1, 20));
		//g.drawRect(1, 1, WIDTH-1, HEIGHT-1);
		g.drawString(Double.toString(10), 40,40);
		g.dispose();
		bs.show();
	}
}
